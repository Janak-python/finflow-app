<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FinFlow</title>
  <link rel="icon" type="image/png" href="finflow.png">
  <!-- Add this to your head section after the favicon -->
<meta name="theme-color" content="#667eea">
<link rel="manifest" href="app.webmanifest">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at top left, #667eea, #764ba2 60%, #473f7c 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #fff;
      overflow-y: auto;
      padding: 20px 0;
    }

    .main-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 100%;
    }

    .hamburger {
      font-size: 1.8em;
      cursor: pointer;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 2001;
      background: rgba(255,255,255,0.06);
      padding: 6px 10px;
      border-radius: 8px;
    }

    /* PIN Lock Styles */
    .pin-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at top left, #667eea, #764ba2 60%, #473f7c 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }

    .pin-container {
      background: rgba(31,31,46,0.95);
      border-radius: 25px;
      padding: 30px;
      box-shadow: 0 0 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 300px;
    }

    .pin-display {
      font-size: 2em;
      letter-spacing: 10px;
      color: #ffd700;
      margin: 10px 0;
    }

    .pin-dot {
      display: inline-block;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: #ffd700;
      margin: 0 5px;
    }

    .pin-dot.empty {
      background: rgba(255,255,255,0.2);
    }

    .pin-keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      width: 100%;
    }

    .pin-key {
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      color: #fff;
      font-size: 1.5em;
      cursor: pointer;
      transition: all 0.3s;
    }

    .pin-key:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.1);
    }

    .pin-key:active {
      background: rgba(255,255,255,0.3);
      transform: scale(0.95);
    }

    .pin-clear {
      background: rgba(220,53,69,0.7);
    }

    .pin-submit {
      background: rgba(40,167,69,0.7);
    }

    .setup-pin-message {
      text-align: center;
      color: #ffd700;
      font-size: 0.9em;
      margin-top: 10px;
    }

    /* Updated wallet box to match transaction design */
    .wallet-box {
      border-radius: 25px;
      padding: 25px;
      box-shadow: 0 0 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 400px;
      max-width: 100%;
      background: rgba(31,31,46,0.9);
    }

    .wallet-inner {
      background: rgba(255,255,255,0.06);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .wallet-balance { 
      font-size: 1.8em; 
      margin: 10px 0; 
      color: #ffd700; 
      font-weight: bold;
    }

    .wallet-name {
      font-size: 1.1em;
      color: #ffd700;
      margin: 0;
    }

    .transaction-box, .history-box {
      border-radius: 25px;
      padding: 25px;
      box-shadow: 0 0 40px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 400px;
      max-width: 100%;
    }

    .transaction-box {
      background: rgba(31,31,46,0.9);
    }

    .transaction-inner {
      background: rgba(255,255,255,0.06);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-box {
      background: rgba(31,31,46,0.9);
      width: 90%;
      max-width: 1000px;
    }

    .history-inner {
      background: rgba(255,255,255,0.06);
      border-radius: 15px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    h2 {
      margin: 0;
      font-size: 0.95em;
      color: #ffd700;
      margin-bottom: 10px;
    }

    select, input {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 0.95em;
      background: rgba(255,255,255,0.1);
      color: #fff;
    }

    select option {
      color: #000;
    }

    .row {
      display: flex;
      gap: 10px;
    }

    .row input, .row select {
      flex: 1;
    }

    button.add-category, button.add-transaction {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    button.add-category { background: #32cd32; color: #fff; }
    button.add-transaction { background: #ffd700; color: #000; align-self: center; margin-top: 10px; }

    .history-header, .history-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
      color: #fff;
    }

    .history-header {
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 5px;
    }

    .history-item {
      padding: 6px 0;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      margin-bottom: 6px;
      word-break: break-word;
      background: rgba(255,255,255,0.06);
    }

    .full-screen-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(30,30,46,0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .full-screen-menu.active { display: flex; }

    .menu-inner {
      background: rgba(45,45,70,0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .menu-button {
      width: 220px;
      padding: 15px;
      margin: 10px 0;
      border: none;
      border-radius: 12px;
      background: #ffd700;
      color: #1f1f2e;
      font-weight: bold;
      font-size: 1.2em;
      cursor: pointer;
      transition: background 0.3s;
    }

    .menu-button:hover { background: #e6c200; }

    .wallet-list-button {
      width: 220px;
      padding: 15px;
      margin: 5px 0;
      border: none;
      border-radius: 12px;
      background: #00bfff;
      color: #1f1f2e;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .wallet-list-button:hover { background: #009acd; }

    .wallet-form {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 15px;
    }

    .wallet-form input {
      width: 200px;
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: none;
      outline: none;
    }

    .wallet-form button {
      margin-top: 10px;
      background: #32cd32;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- PIN Lock Overlay -->
  <div class="pin-overlay" id="pinOverlay">
    <div class="pin-container">
      <h2 id="pinTitle">Enter PIN</h2>
      <div class="pin-display" id="pinDisplay">
        <span class="pin-dot empty"></span>
        <span class="pin-dot empty"></span>
        <span class="pin-dot empty"></span>
        <span class="pin-dot empty"></span>
      </div>
      <div class="pin-keypad">
        <button class="pin-key" onclick="addPinDigit('1')">1</button>
        <button class="pin-key" onclick="addPinDigit('2')">2</button>
        <button class="pin-key" onclick="addPinDigit('3')">3</button>
        <button class="pin-key" onclick="addPinDigit('4')">4</button>
        <button class="pin-key" onclick="addPinDigit('5')">5</button>
        <button class="pin-key" onclick="addPinDigit('6')">6</button>
        <button class="pin-key" onclick="addPinDigit('7')">7</button>
        <button class="pin-key" onclick="addPinDigit('8')">8</button>
        <button class="pin-key" onclick="addPinDigit('9')">9</button>
        <button class="pin-key pin-clear" onclick="clearPin()">C</button>
        <button class="pin-key" onclick="addPinDigit('0')">0</button>
        <button class="pin-key pin-submit" onclick="submitPin()">✓</button>
      </div>
      <div class="setup-pin-message" id="pinMessage">
        Set up your 4-digit PIN for security
      </div>
    </div>
  </div>

  <div class="hamburger" onclick="toggleMenu()">☰</div>

  <div class="main-panel" id="mainPanel" style="display: none;">
    <!-- Updated wallet box to match transaction design -->
    <div class="wallet-box">
      <div class="wallet-inner" id="selectedWalletBox">
        <h2>Wallet</h2>
        <h3 class="wallet-name" id="selectedWalletName">Select a Wallet</h3>
        <div class="wallet-balance" id="selectedWalletBalance">$0.00</div>
      </div>
    </div>

    <div class="transaction-box">
      <div class="transaction-inner" id="transactionBox">
        <h2>New Transaction</h2>
        <select id="transactionType">
          <option value="expense">Expense</option>
          <option value="income">Income</option>
          <option value="transfer">Transfer</option>
        </select>
        <input type="number" placeholder="Amount" id="transactionAmount">
        <input type="text" placeholder="DD/MM/YYYY" id="transactionDate" maxlength="10">
        <input type="text" placeholder="Reason" id="transactionReason">
        <div class="row">
          <select id="categorySelect"></select>
          <input type="text" placeholder="Add Category" id="addCategory">
          <button class="add-category" onclick="addCategory()">Add</button>
        </div>
        <button class="add-transaction" onclick="addTransaction()">Add Transaction</button>
      </div>
    </div>

    <div class="history-box">
      <div class="history-inner" id="historyBox">
        <h2>Transaction History</h2>
        <div class="history-header">
          <span style="flex:2">Category</span>
          <span style="flex:2">Date</span>
          <span style="flex:1">Amount</span>
          <span style="flex:1">Type</span>
          <span style="flex:3">Reason</span>
        </div>
        <div id="historyItems">
          <!-- Transactions will appear here -->
        </div>
      </div>
    </div>
  </div>

  <div class="full-screen-menu" id="fullScreenMenu" onclick="closeMenuOnBackground(event)">
    <div class="menu-inner" onclick="event.stopPropagation();">
      <button class="menu-button" onclick="toggleWalletForm()">Create Wallet</button>
      <div class="wallet-form" id="walletForm">
        <input type="text" id="walletNameInput" placeholder="Wallet Name">
        <input type="number" id="walletBalanceInput" placeholder="Initial Balance">
        <button onclick="createWallet()">Save Wallet</button>
      </div>
      <p style="color:#fff; margin:10px 0; font-size:1.1em;">Choose a wallet:</p>
      <div id="walletListMenu"></div>
      <button class="menu-button" onclick="changePin()" style="margin-top: 20px; background: #6c757d;">Change PIN</button>
    </div>
  </div>

  <script>
    // PIN Lock Variables
    let currentPin = '';
    let storedPin = localStorage.getItem('finflow_pin');
    let isSettingUpPin = !storedPin;
    let pinAttempts = 0;

    // Initialize data from localStorage
    let wallets = JSON.parse(localStorage.getItem('wallets')) || [];
    let selectedWalletIndex = localStorage.getItem('selectedWalletIndex') !== null ? 
                             parseInt(localStorage.getItem('selectedWalletIndex')) : null;
    let categories = JSON.parse(localStorage.getItem('categories')) || ['Food', 'Transport', 'Shopping', 'Entertainment'];
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    // PIN Lock Functions
    function initializePinLock() {
      if (isSettingUpPin) {
        document.getElementById('pinTitle').textContent = 'Set Up PIN';
        document.getElementById('pinMessage').textContent = 'Set up your 4-digit PIN for security';
      } else {
        document.getElementById('pinTitle').textContent = 'Enter PIN';
        document.getElementById('pinMessage').textContent = 'Enter your 4-digit PIN to access FinFlow';
      }
      updatePinDisplay();
    }

    function addPinDigit(digit) {
      if (currentPin.length < 4) {
        currentPin += digit;
        updatePinDisplay();
        
        // Auto-submit when 4 digits are entered
        if (currentPin.length === 4) {
          setTimeout(submitPin, 300);
        }
      }
    }

    function clearPin() {
      currentPin = '';
      updatePinDisplay();
    }

    function updatePinDisplay() {
      const display = document.getElementById('pinDisplay');
      const dots = display.querySelectorAll('.pin-dot');
      
      dots.forEach((dot, index) => {
        if (index < currentPin.length) {
          dot.classList.remove('empty');
        } else {
          dot.classList.add('empty');
        }
      });
    }

    function submitPin() {
      if (currentPin.length !== 4) return;

      if (isSettingUpPin) {
        // Setting up new PIN
        localStorage.setItem('finflow_pin', currentPin);
        storedPin = currentPin;
        isSettingUpPin = false;
        unlockApp();
      } else {
        // Verifying existing PIN
        if (currentPin === storedPin) {
          pinAttempts = 0;
          unlockApp();
        } else {
          pinAttempts++;
          currentPin = '';
          updatePinDisplay();
          document.getElementById('pinMessage').textContent = `Wrong PIN! Attempt ${pinAttempts}/3`;
          
          if (pinAttempts >= 3) {
            document.getElementById('pinMessage').textContent = 'Too many attempts. Please refresh the page.';
            disablePinKeypad();
          }
        }
      }
    }

    function disablePinKeypad() {
      const keys = document.querySelectorAll('.pin-key');
      keys.forEach(key => {
        key.disabled = true;
        key.style.opacity = '0.5';
        key.style.cursor = 'not-allowed';
      });
    }

    function unlockApp() {
      document.getElementById('pinOverlay').style.display = 'none';
      document.getElementById('mainPanel').style.display = 'flex';
      
      // Initialize the app
      initializeCategories();
      initializeTransactionHistory();
      renderMenuWallets();
      updateSelectedWalletBox();
      setWhiteColor(document.getElementById('transactionType'));
      setWhiteColor(document.getElementById('categorySelect'));
    }

    function changePin() {
      const currentPinInput = prompt('Enter current PIN:');
      if (currentPinInput === storedPin) {
        const newPin = prompt('Enter new 4-digit PIN:');
        if (newPin && newPin.length === 4 && /^\d+$/.test(newPin)) {
          localStorage.setItem('finflow_pin', newPin);
          storedPin = newPin;
          alert('PIN changed successfully!');
          document.getElementById('fullScreenMenu').classList.remove('active');
        } else {
          alert('Invalid PIN. Must be 4 digits.');
        }
      } else {
        alert('Incorrect current PIN.');
      }
    }

    // Initialize PIN lock when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializePinLock();
    });

    // Rest of your existing functions (categories, transactions, wallets, etc.)
    // ... [All your existing JavaScript functions remain the same] ...
    // Initialize categories dropdown
    function initializeCategories() {
      const categorySelect = document.getElementById('categorySelect');
      categorySelect.innerHTML = '';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }

    // Initialize transaction history
    function initializeTransactionHistory() {
      const historyItems = document.getElementById('historyItems');
      historyItems.innerHTML = '';
      transactions.forEach(transaction => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.style.display = 'flex';
        item.innerHTML = `
          <span style='flex:2'>${transaction.category}</span>
          <span style='flex:2'>${transaction.date}</span>
          <span style='flex:1'>${transaction.amount}</span>
          <span style='flex:1'>${transaction.type}</span>
          <span style='flex:3'>${transaction.reason}</span>
        `;
        historyItems.appendChild(item);
      });
    }

    // Date input formatting
    const dateInput = document.getElementById('transactionDate');
    dateInput.addEventListener('input', (e) => {
      let val = e.target.value.replace(/\D/g, '');
      if (val.length >= 3 && val[2] !== '/') val = val.slice(0,2) + '/' + val.slice(2);
      if (val.length >= 6 && val[5] !== '/') val = val.slice(0,5) + '/' + val.slice(5);
      e.target.value = val;
    });

    // Add category function
    function addCategory() {
      const input = document.getElementById('addCategory');
      const value = input.value.trim();
      if(value && !categories.includes(value)) {
        categories.push(value);
        localStorage.setItem('categories', JSON.stringify(categories));
        initializeCategories();
        input.value = '';
      }
    }

    // Add transaction function
    function addTransaction() {
      const type = document.getElementById('transactionType').value;
      const amount = document.getElementById('transactionAmount').value;
      const date = document.getElementById('transactionDate').value;
      const category = document.getElementById('categorySelect').value;
      const reason = document.getElementById('transactionReason').value;
      
      if(!type || !amount || !date || !category) return;

      // Create transaction object
      const transaction = {
        type,
        amount,
        date,
        category,
        reason,
        walletIndex: selectedWalletIndex,
        timestamp: new Date().toISOString()
      };

      // Add to transactions array and save to localStorage
      transactions.push(transaction);
      localStorage.setItem('transactions', JSON.stringify(transactions));

      // Update wallet balance if a wallet is selected
      if (selectedWalletIndex !== null) {
        const wallet = wallets[selectedWalletIndex];
        const amountNum = parseFloat(amount);
        
        if (type === 'income') {
          wallet.balance += amountNum;
        } else if (type === 'expense') {
          wallet.balance -= amountNum;
        }
        // For transfer, you might want to handle differently
        
        localStorage.setItem('wallets', JSON.stringify(wallets));
        updateSelectedWalletBox();
        renderMenuWallets();
      }

      // Add to UI
      const historyItems = document.getElementById('historyItems');
      const item = document.createElement('div');
      item.className = 'history-item';
      item.style.display = 'flex';
      item.innerHTML = `
        <span style='flex:2'>${category}</span>
        <span style='flex:2'>${date}</span>
        <span style='flex:1'>${amount}</span>
        <span style='flex:1'>${type}</span>
        <span style='flex:3'>${reason}</span>
      `;
      historyItems.appendChild(item);

      // Clear form
      document.getElementById('transactionAmount').value = '';
      document.getElementById('transactionDate').value = '';
      document.getElementById('transactionReason').value = '';
    }

    // Set white color for dropdowns
    function setWhiteColor(el) {
      el.addEventListener('change', () => { el.style.color = '#fff'; });
      el.addEventListener('focus', () => { el.style.color = '#fff'; });
      el.style.color = '#fff';
    }

    // Wallet management functions
    function toggleMenu() {
      const menu = document.getElementById('fullScreenMenu');
      menu.classList.toggle('active');
      renderMenuWallets();
    }

    function closeMenuOnBackground(e) {
      if (e.target.id === 'fullScreenMenu') document.getElementById('fullScreenMenu').classList.remove('active');
    }

    function toggleWalletForm() {
      const form = document.getElementById('walletForm');
      form.style.display = form.style.display === 'flex' ? 'none' : 'flex';
    }

    function createWallet() {
      const name = document.getElementById('walletNameInput').value.trim();
      const balanceStr = document.getElementById('walletBalanceInput').value.trim();
      const balance = parseFloat(balanceStr) || 0;
      if (!name) return alert('Please enter wallet name');
      wallets.push({ name, balance });
      localStorage.setItem('wallets', JSON.stringify(wallets));
      document.getElementById('walletNameInput').value = '';
      document.getElementById('walletBalanceInput').value = '';
      toggleWalletForm();
      renderMenuWallets();
      updateSelectedWalletBox();
    }

    function renderMenuWallets() {
      const listDiv = document.getElementById('walletListMenu');
      listDiv.innerHTML = '';
      wallets.forEach((w, index) => {
        const btn = document.createElement('button');
        btn.className = 'wallet-list-button';
        btn.innerHTML = `<span>${w.name}</span><span>$${w.balance.toFixed(2)}</span>`;
        btn.onclick = () => { 
          selectWallet(index); 
          document.getElementById('fullScreenMenu').classList.remove('active'); 
        };
        listDiv.appendChild(btn);
      });
    }

    function selectWallet(index) {
      selectedWalletIndex = index;
      localStorage.setItem('selectedWalletIndex', index);
      updateSelectedWalletBox();
    }

    function updateSelectedWalletBox() {
      const nameEl = document.getElementById('selectedWalletName');
      const balanceEl = document.getElementById('selectedWalletBalance');
      if (selectedWalletIndex !== null && wallets[selectedWalletIndex]) {
        nameEl.textContent = wallets[selectedWalletIndex].name;
        balanceEl.textContent = `$${wallets[selectedWalletIndex].balance.toFixed(2)}`;
      } else {
        nameEl.textContent = 'Select a Wallet';
        balanceEl.textContent = '$0.00';
      }
    }
  </script>
</body>
</html>